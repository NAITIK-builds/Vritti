<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vritti - Tasks</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        /* Subject color coding */
        .subject-math { background-color: #3b82f6; }
        .subject-science { background-color: #10b981; }
        .subject-english { background-color: #f59e0b; }
        .subject-history { background-color: #8b5cf6; }
        .subject-computer { background-color: #ec4899; }
        .subject-other { background-color: #64748b; }
        
        /* Priority colors */
        .priority-high { background-color: #fecaca; border-color: #f87171; }
        .priority-medium { background-color: #fef08a; border-color: #f59e0b; }
        .priority-low { background-color: #bbf7d0; border-color: #4ade80; }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        /* Drag and drop styles */
        .drag-over {
            border: 2px dashed #6366f1;
            background-color: #e0e7ff;
        }
        
        .dragging {
            opacity: 0.5;
            transform: scale(0.98);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen font-sans">
    <!-- Navigation Bar -->
    <nav class="gradient-bg text-white shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="flex items-center mb-4 md:mb-0">
                    <i class="fas fa-brain text-3xl mr-3 text-yellow-300"></i>
                    <h1 class="text-2xl font-bold">Vritti</h1>
                    <span class="ml-2 text-xs bg-yellow-500 text-gray-900 px-2 py-1 rounded-full">Beta</span>
                </div>
                <div class="flex space-x-1 overflow-x-auto w-full md:w-auto pb-2 md:pb-0">
                    <a href="index.html" class="nav-item px-4 py-2 rounded-lg hover:bg-white hover:bg-opacity-10 font-medium">
                        <i class="fas fa-home mr-2"></i>Home
                    </a>
                    <a href="schedule.html" class="nav-item px-4 py-2 rounded-lg hover:bg-white hover:bg-opacity-10 font-medium">
                        <i class="fas fa-calendar-alt mr-2"></i>Schedule
                    </a>
                    <a href="tasks.html" class="nav-item px-4 py-2 rounded-lg bg-white bg-opacity-20 font-medium">
                        <i class="fas fa-tasks mr-2"></i>Tasks
                    </a>
                    <a href="progress.html" class="nav-item px-4 py-2 rounded-lg hover:bg-white hover:bg-opacity-10 font-medium">
                        <i class="fas fa-chart-line mr-2"></i>Progress
                    </a>
                    <a href="resources.html" class="nav-item px-4 py-2 rounded-lg hover:bg-white hover:bg-opacity-10 font-medium">
                        <i class="fas fa-book mr-2"></i>Resources
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Tasks Header -->
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
            <div>
                <h2 class="text-2xl font-bold text-gray-800 mb-2">My Tasks</h2>
                <p class="text-gray-600">Organize your academic tasks and assignments</p>
            </div>
            <div class="mt-4 md:mt-0 flex space-x-3">
                <button id="save-tasks" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors">
                    <i class="fas fa-save mr-2"></i>Save Tasks
                </button>
                <button id="add-task" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                    <i class="fas fa-plus mr-2"></i>Add Task
                </button>
            </div>
        </div>

        <!-- Task Filters -->
        <div class="bg-white rounded-xl shadow-md p-4 mb-6">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between space-y-3 md:space-y-0">
                <div class="flex items-center space-x-2">
                    <span class="text-gray-700">Filter:</span>
                    <select id="filter-status" class="px-3 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm">
                        <option value="all">All Tasks</option>
                        <option value="active">Active</option>
                        <option value="completed">Completed</option>
                    </select>
                    <select id="filter-priority" class="px-3 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm">
                        <option value="all">All Priorities</option>
                        <option value="high">High</option>
                        <option value="medium">Medium</option>
                        <option value="low">Low</option>
                    </select>
                    <select id="filter-subject" class="px-3 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm">
                        <option value="all">All Subjects</option>
                        <option value="math">Math</option>
                        <option value="science">Science</option>
                        <option value="english">English</option>
                        <option value="history">History</option>
                        <option value="computer">Computer</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="flex items-center space-x-2">
                    <span class="text-gray-700">Sort:</span>
                    <select id="sort-tasks" class="px-3 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 text-sm">
                        <option value="due-date">Due Date</option>
                        <option value="priority">Priority</option>
                        <option value="created">Recently Added</option>
                        <option value="subject">Subject</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Task Columns -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- To Do Column -->
            <div class="bg-white rounded-xl shadow-md overflow-hidden">
                <div class="bg-blue-100 px-6 py-3 border-b border-blue-200">
                    <h3 class="text-lg font-semibold text-blue-800 flex items-center justify-between">
                        <span><i class="fas fa-list-ul mr-2"></i> To Do</span>
                        <span class="text-sm font-normal bg-blue-200 text-blue-800 px-2 py-1 rounded-full" id="todo-count">0</span>
                    </h3>
                </div>
                <div id="todo-tasks" class="p-4 space-y-3 min-h-32 task-column" data-status="todo">
                    <div class="text-center py-8 text-gray-500 empty-column-message">
                        <i class="fas fa-check-circle text-3xl mb-2"></i>
                        <p>No tasks to do</p>
                        <button class="text-blue-600 text-sm hover:underline mt-2 add-task-btn">
                            Add your first task
                        </button>
                    </div>
                </div>
            </div>

            <!-- In Progress Column -->
            <div class="bg-white rounded-xl shadow-md overflow-hidden">
                <div class="bg-yellow-100 px-6 py-3 border-b border-yellow-200">
                    <h3 class="text-lg font-semibold text-yellow-800 flex items-center justify-between">
                        <span><i class="fas fa-spinner mr-2"></i> In Progress</span>
                        <span class="text-sm font-normal bg-yellow-200 text-yellow-800 px-2 py-1 rounded-full" id="progress-count">0</span>
                    </h3>
                </div>
                <div id="progress-tasks" class="p-4 space-y-3 min-h-32 task-column" data-status="progress">
                    <div class="text-center py-8 text-gray-500 empty-column-message">
                        <i class="fas fa-hourglass-half text-3xl mb-2"></i>
                        <p>No tasks in progress</p>
                    </div>
                </div>
            </div>

            <!-- Completed Column -->
            <div class="bg-white rounded-xl shadow-md overflow-hidden">
                <div class="bg-green-100 px-6 py-3 border-b border-green-200">
                    <h3 class="text-lg font-semibold text-green-800 flex items-center justify-between">
                        <span><i class="fas fa-check-circle mr-2"></i> Completed</span>
                        <span class="text-sm font-normal bg-green-200 text-green-800 px-2 py-1 rounded-full" id="completed-count">0</span>
                    </h3>
                </div>
                <div id="completed-tasks" class="p-4 space-y-3 min-h-32 task-column" data-status="completed">
                    <div class="text-center py-8 text-gray-500 empty-column-message">
                        <i class="fas fa-trophy text-3xl mb-2"></i>
                        <p>No tasks completed yet</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Task Modal -->
        <div id="task-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white rounded-xl shadow-xl w-full max-w-md mx-4 fade-in">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-semibold text-gray-800">Add New Task</h3>
                </div>
                <div class="p-6">
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">Task Title*</label>
                        <input type="text" id="task-title" placeholder="E.g. Complete Math Assignment" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2">Description</label>
                        <textarea id="task-description" rows="3" placeholder="Task details..." class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-gray-700 mb-2">Due Date</label>
                            <input type="date" id="task-due-date" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2">Priority</label>
                            <select id="task-priority" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                <option value="medium">Medium</option>
                                <option value="high">High</option>
                                <option value="low">Low</option>
                            </select>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-gray-700 mb-2">Subject</label>
                            <select id="task-subject" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                <option value="math">Math</option>
                                <option value="science">Science</option>
                                <option value="english">English</option>
                                <option value="history">History</option>
                                <option value="computer">Computer</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2">Status</label>
                            <select id="task-status" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                <option value="todo">To Do</option>
                                <option value="progress">In Progress</option>
                                <option value="completed">Completed</option>
                            </select>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="flex items-center">
                            <input type="checkbox" id="task-reminder" class="rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                            <span class="ml-2 text-gray-700">Set Reminder</span>
                        </label>
                        <div id="reminder-options" class="mt-2 ml-6 hidden">
                            <input type="datetime-local" id="task-reminder-time" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        </div>
                    </div>
                </div>
                <div class="px-6 py-4 border-t border-gray-200 flex justify-end space-x-3">
                    <button id="cancel-task" class="px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-md">Cancel</button>
                    <button id="save-task" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">Add Task</button>
                </div>
            </div>
        </div>

        <!-- Task Template (hidden) -->
        <template id="task-template">
            <div class="task-item bg-white rounded-lg shadow-sm border-l-4 p-4 draggable-item" draggable="true">
                <div class="flex justify-between items-start mb-2">
                    <div class="flex items-center">
                        <input type="checkbox" class="task-checkbox h-5 w-5 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500">
                        <h4 class="task-title font-medium ml-2"></h4>
                    </div>
                    <div class="flex space-x-2">
                        <button class="edit-task text-gray-400 hover:text-indigo-600">
                            <i class="fas fa-pencil-alt text-sm"></i>
                        </button>
                        <button class="delete-task text-gray-400 hover:text-red-600">
                            <i class="fas fa-trash-alt text-sm"></i>
                        </button>
                    </div>
                </div>
                <p class="task-description text-sm text-gray-600 mb-2"></p>
                <div class="flex flex-wrap items-center justify-between text-xs text-gray-500">
                    <div class="flex items-center space-x-2">
                        <span class="task-priority px-2 py-1 rounded-full"></span>
                        <span class="task-subject px-2 py-1 rounded-full text-white"></span>
                    </div>
                    <div>
                        <span class="task-due-date"></span>
                        <span class="task-reminder ml-2 hidden"><i class="fas fa-bell"></i></span>
                    </div>
                </div>
            </div>
        </template>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Load tasks from localStorage
            loadTasks();

            // Add event listeners
            document.getElementById('add-task').addEventListener('click', showAddTaskModal);
            document.querySelectorAll('.add-task-btn').forEach(btn => {
                btn.addEventListener('click', showAddTaskModal);
            });
            document.getElementById('save-tasks').addEventListener('click', saveTasks);
            document.getElementById('cancel-task').addEventListener('click', hideAddTaskModal);
            document.getElementById('save-task').addEventListener('click', addTask);
            
            // Filter and sort event listeners
            document.getElementById('filter-status').addEventListener('change', filterTasks);
            document.getElementById('filter-priority').addEventListener('change', filterTasks);
            document.getElementById('filter-subject').addEventListener('change', filterTasks);
            document.getElementById('sort-tasks').addEventListener('change', filterTasks);
            
            // Reminder checkbox
            document.getElementById('task-reminder').addEventListener('change', function() {
                document.getElementById('reminder-options').classList.toggle('hidden', !this.checked);
            });

            // Set up drag and drop
            setupDragAndDrop();
        });

        // Load tasks from localStorage
        function loadTasks() {
            const tasks = JSON.parse(localStorage.getItem('studyTasks')) || [];
            renderTasks(tasks);
        }

        // Render tasks
        function renderTasks(tasks) {
            const todoContainer = document.getElementById('todo-tasks');
            const progressContainer = document.getElementById('progress-tasks');
            const completedContainer = document.getElementById('completed-tasks');
            
            // Clear existing tasks
            todoContainer.querySelectorAll('.task-item').forEach(task => task.remove());
            progressContainer.querySelectorAll('.task-item').forEach(task => task.remove());
            completedContainer.querySelectorAll('.task-item').forEach(task => task.remove());
            
            // Count tasks for each status
            let todoCount = 0;
            let progressCount = 0;
            let completedCount = 0;
            
            // Filter tasks based on UI filters
            const filteredTasks = filterTaskList(tasks);
            
            filteredTasks.forEach((task, index) => {
                const newTask = createTaskElement(task, index);
                
                switch(task.status) {
                    case 'todo':
                        todoContainer.insertBefore(newTask, todoContainer.querySelector('.empty-column-message'));
                        todoCount++;
                        break;
                    case 'progress':
                        progressContainer.insertBefore(newTask, progressContainer.querySelector('.empty-column-message'));
                        progressCount++;
                        break;
                    case 'completed':
                        completedContainer.insertBefore(newTask, completedContainer.querySelector('.empty-column-message'));
                        completedCount++;
                        break;
                }
            });
            
            // Update counts
            document.getElementById('todo-count').textContent = todoCount;
            document.getElementById('progress-count').textContent = progressCount;
            document.getElementById('completed-count').textContent = completedCount;
            
            // Show/hide empty messages
            todoContainer.querySelector('.empty-column-message').classList.toggle('hidden', todoCount > 0);
            progressContainer.querySelector('.empty-column-message').classList.toggle('hidden', progressCount > 0);
            completedContainer.querySelector('.empty-column-message').classList.toggle('hidden', completedCount > 0);
        }

        // Create task element
        function createTaskElement(task, index) {
            const template = document.getElementById('task-template');
            const clone = template.content.cloneNode(true);
            
            const taskItem = clone.querySelector('.task-item');
            taskItem.id = `task-${task.id}`;
            taskItem.dataset.index = index;
            taskItem.dataset.priority = task.priority;
            taskItem.dataset.subject = task.subject;
            taskItem.dataset.status = task.status;
            
            // Set priority border color
            if (task.priority === 'high') {
                taskItem.classList.add('border-red-500');
            } else if (task.priority === 'medium') {
                taskItem.classList.add('border-yellow-500');
            } else {
                taskItem.classList.add('border-green-500');
            }
            
            // Set task details
            clone.querySelector('.task-title').textContent = task.title;
            clone.querySelector('.task-description').textContent = task.description || 'No description';
            
            // Set checkbox
            const checkbox = clone.querySelector('.task-checkbox');
            checkbox.checked = task.status === 'completed';
            checkbox.addEventListener('change', function() {
                toggleTaskCompletion(task.id, this.checked);
            });
            
            // Set priority badge
            const priorityBadge = clone.querySelector('.task-priority');
            priorityBadge.textContent = task.priority.charAt(0).toUpperCase() + task.priority.slice(1);
            priorityBadge.classList.add(`priority-${task.priority}`);
            
            // Set subject badge
            const subjectBadge = clone.querySelector('.task-subject');
            subjectBadge.textContent = task.subject.charAt(0).toUpperCase() + task.subject.slice(1);
            subjectBadge.classList.add(`subject-${task.subject}`);
            
            // Set due date
            const dueDateElement = clone.querySelector('.task-due-date');
            if (task.dueDate) {
                dueDateElement.textContent = formatDate(task.dueDate);
            } else {
                dueDateElement.textContent = 'No deadline';
            }
            
            // Set reminder
            if (task.reminder) {
                clone.querySelector('.task-reminder').classList.remove('hidden');
            }
            
            // Add event listeners to buttons
            clone.querySelector('.edit-task').addEventListener('click', () => editTask(task.id));
            clone.querySelector('.delete-task').addEventListener('click', () => deleteTask(task.id));
            
            return clone;
        }

        // Show add task modal
        function showAddTaskModal() {
            document.getElementById('task-modal').classList.remove('hidden');
            
            // Set default due date to tomorrow
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('task-due-date').valueAsDate = tomorrow;
            
            document.getElementById('task-title').focus();
        }

        // Hide add task modal
        function hideAddTaskModal() {
            document.getElementById('task-modal').classList.add('hidden');
            // Reset form
            document.getElementById('task-title').value = '';
            document.getElementById('task-description').value = '';
            document.getElementById('task-due-date').value = '';
            document.getElementById('task-priority').value = 'medium';
            document.getElementById('task-subject').value = 'math';
            document.getElementById('task-status').value = 'todo';
            document.getElementById('task-reminder').checked = false;
            document.getElementById('reminder-options').classList.add('hidden');
            document.getElementById('task-reminder-time').value = '';
        }

        // Add new task
        function addTask() {
            const title = document.getElementById('task-title').value.trim();
            const description = document.getElementById('task-description').value.trim();
            const dueDate = document.getElementById('task-due-date').value;
            const priority = document.getElementById('task-priority').value;
            const subject = document.getElementById('task-subject').value;
            const status = document.getElementById('task-status').value;
            const reminder = document.getElementById('task-reminder').checked;
            const reminderTime = document.getElementById('task-reminder-time').value;
            
            // Validate inputs
            if (!title) {
                alert('Please enter a task title');
                return;
            }
            
            // Create new task
            const newTask = {
                id: Date.now().toString(),
                title,
                description,
                dueDate,
                priority,
                subject,
                status,
                createdAt: new Date().toISOString(),
                completed: status === 'completed',
                completedAt: status === 'completed' ? new Date().toISOString() : null,
                reminder: reminder,
                reminderTime: reminder ? reminderTime : null
            };
            
            // Get current tasks
            const tasks = JSON.parse(localStorage.getItem('studyTasks')) || [];
            
            // Add new task
            tasks.push(newTask);
            
            // Save and render
            localStorage.setItem('studyTasks', JSON.stringify(tasks));
            renderTasks(tasks);
            
            // Hide modal
            hideAddTaskModal();
            
            // Set reminder if needed
            if (reminder && reminderTime) {
                setTaskReminder(newTask);
            }
        }

        // Edit task
        function editTask(taskId) {
            const tasks = JSON.parse(localStorage.getItem('studyTasks'));
            const task = tasks.find(t => t.id === taskId);
            
            if (!task) return;
            
            // Fill modal with task data
            document.getElementById('task-title').value = task.title;
            document.getElementById('task-description').value = task.description || '';
            document.getElementById('task-due-date').value = task.dueDate || '';
            document.getElementById('task-priority').value = task.priority;
            document.getElementById('task-subject').value = task.subject;
            document.getElementById('task-status').value = task.status;
            document.getElementById('task-reminder').checked = task.reminder || false;
            document.getElementById('reminder-options').classList.toggle('hidden', !task.reminder);
            document.getElementById('task-reminder-time').value = task.reminderTime || '';
            
            // Show modal
            document.getElementById('task-modal').classList.remove('hidden');
            
            // Change save button to update
            const saveBtn = document.getElementById('save-task');
            saveBtn.textContent = 'Update Task';
            saveBtn.onclick = function() {
                updateTask(taskId);
            };
        }

        // Update task
        function updateTask(taskId) {
            const tasks = JSON.parse(localStorage.getItem('studyTasks'));
            const taskIndex = tasks.findIndex(t => t.id === taskId);
            
            if (taskIndex === -1) return;
            
            // Update task
            tasks[taskIndex] = {
                ...tasks[taskIndex],
                title: document.getElementById('task-title').value.trim(),
                description: document.getElementById('task-description').value.trim(),
                dueDate: document.getElementById('task-due-date').value,
                priority: document.getElementById('task-priority').value,
                subject: document.getElementById('task-subject').value,
                status: document.getElementById('task-status').value,
                completed: document.getElementById('task-status').value === 'completed',
                completedAt: document.getElementById('task-status').value === 'completed' ? 
                    (tasks[taskIndex].completedAt || new Date().toISOString()) : null,
                reminder: document.getElementById('task-reminder').checked,
                reminderTime: document.getElementById('task-reminder').checked ? 
                    document.getElementById('task-reminder-time').value : null
            };
            
            // Save and render
            localStorage.setItem('studyTasks', JSON.stringify(tasks));
            renderTasks(tasks);
            
            // Reset save button
            const saveBtn = document.getElementById('save-task');
            saveBtn.textContent = 'Add Task';
            saveBtn.onclick = addTask;
            
            // Hide modal
            hideAddTaskModal();
            
            // Update reminder if needed
            if (tasks[taskIndex].reminder && tasks[taskIndex].reminderTime) {
                setTaskReminder(tasks[taskIndex]);
            }
        }

        // Delete task
        function deleteTask(taskId) {
            if (!confirm('Are you sure you want to delete this task?')) return;
            
            const tasks = JSON.parse(localStorage.getItem('studyTasks'));
            const updatedTasks = tasks.filter(task => task.id !== taskId);
            
            localStorage.setItem('studyTasks', JSON.stringify(updatedTasks));
            renderTasks(updatedTasks);
        }

        // Toggle task completion
        function toggleTaskCompletion(taskId, isCompleted) {
            const tasks = JSON.parse(localStorage.getItem('studyTasks'));
            const taskIndex = tasks.findIndex(t => t.id === taskId);
            
            if (taskIndex === -1) return;
            
            tasks[taskIndex].completed = isCompleted;
            tasks[taskIndex].completedAt = isCompleted ? new Date().toISOString() : null;
            tasks[taskIndex].status = isCompleted ? 'completed' : 'todo';
            
            localStorage.setItem('studyTasks', JSON.stringify(tasks));
            renderTasks(tasks);
        }

        // Save tasks
        function saveTasks() {
            // Already saved when adding/editing tasks
            alert('Tasks saved successfully!');
        }

        // Filter tasks based on UI selections
        function filterTasks() {
            const tasks = JSON.parse(localStorage.getItem('studyTasks')) || [];
            renderTasks(tasks);
        }

        // Apply filters to task list
        function filterTaskList(tasks) {
            const statusFilter = document.getElementById('filter-status').value;
            const priorityFilter = document.getElementById('filter-priority').value;
            const subjectFilter = document.getElementById('filter-subject').value;
            const sortBy = document.getElementById('sort-tasks').value;
            
            let filteredTasks = [...tasks];
            
            // Apply status filter
            if (statusFilter !== 'all') {
                if (statusFilter === 'active') {
                    filteredTasks = filteredTasks.filter(task => task.status !== 'completed');
                } else {
                    filteredTasks = filteredTasks.filter(task => task.status === statusFilter);
                }
            }
            
            // Apply priority filter
            if (priorityFilter !== 'all') {
                filteredTasks = filteredTasks.filter(task => task.priority === priorityFilter);
            }
            
            // Apply subject filter
            if (subjectFilter !== 'all') {
                filteredTasks = filteredTasks.filter(task => task.subject === subjectFilter);
            }
            
            // Apply sorting
            switch(sortBy) {
                case 'due-date':
                    filteredTasks.sort((a, b) => {
                        if (!a.dueDate && !b.dueDate) return 0;
                        if (!a.dueDate) return 1;
                        if (!b.dueDate) return -1;
                        return new Date(a.dueDate) - new Date(b.dueDate);
                    });
                    break;
                case 'priority':
                    const priorityOrder = { high: 1, medium: 2, low: 3 };
                    filteredTasks.sort((a, b) => priorityOrder[a.priority] - priorityOrder[b.priority]);
                    break;
                case 'created':
                    filteredTasks.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                    break;
                case 'subject':
                    filteredTasks.sort((a, b) => a.subject.localeCompare(b.subject));
                    break;
            }
            
            return filteredTasks;
        }

        // Set up drag and drop functionality
        function setupDragAndDrop() {
            const columns = document.querySelectorAll('.task-column');
            
            columns.forEach(column => {
                column.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    column.classList.add('drag-over');
                });
                
                column.addEventListener('dragleave', () => {
                    column.classList.remove('drag-over');
                });
                
                column.addEventListener('drop', (e) => {
                    e.preventDefault();
                    column.classList.remove('drag-over');
                    
                    const taskId = e.dataTransfer.getData('text/plain');
                    const draggedTask = document.getElementById(taskId);
                    
                    if (draggedTask) {
                        const newStatus = column.dataset.status;
                        const taskIndex = parseInt(draggedTask.dataset.index);
                        
                        // Move task to new column
                        const tasks = JSON.parse(localStorage.getItem('studyTasks'));
                        tasks[taskIndex].status = newStatus;
                        tasks[taskIndex].completed = newStatus === 'completed';
                        tasks[taskIndex].completedAt = newStatus === 'completed' ? new Date().toISOString() : null;
                        
                        // Save and render
                        localStorage.setItem('studyTasks', JSON.stringify(tasks));
                        renderTasks(tasks);
                    }
                });
            });
            
            // Set up draggable items
            document.addEventListener('dragstart', (e) => {
                if (e.target.classList.contains('draggable-item')) {
                    e.target.classList.add('dragging');
                    e.dataTransfer.setData('text/plain', e.target.id);
                    e.dataTransfer.effectAllowed = 'move';
                }
            });
            
            document.addEventListener('dragend', (e) => {
                if (e.target.classList.contains('draggable-item')) {
                    e.target.classList.remove('dragging');
                }
            });
        }

        // Set task reminder
        function setTaskReminder(task) {
            // In a real app, you would use the browser's Notification API or a service worker
            // This is just a placeholder for the functionality
            const reminderTime = new Date(task.reminderTime);
            const now = new Date();
            
            if (reminderTime > now) {
                const timeout = reminderTime - now;
                setTimeout(() => {
                    if (Notification.permission === 'granted') {
                        new Notification(`Reminder: ${task.title}`, {
                            body: task.description || 'Task due soon!',
                            icon: 'https://cdn-icons-png.flaticon.com/512/3976/3976626.png'
                        });
                    } else if (Notification.permission !== 'denied') {
                        Notification.requestPermission().then(permission => {
                            if (permission === 'granted') {
                                new Notification(`Reminder: ${task.title}`, {
                                    body: task.description || 'Task due soon!',
                                    icon: 'https://cdn-icons-png.flaticon.com/512/3976/3976626.png'
                                });
                            }
                        });
                    }
                }, timeout);
            }
        }

        // Helper function to format date
        function formatDate(dateString) {
            if (!dateString) return '';
            
            const options = { weekday: 'short', month: 'short', day: 'numeric' };
            const date = new Date(dateString);
            
            // Check if date is today
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const inputDate = new Date(dateString);
            inputDate.setHours(0, 0, 0, 0);
            
            if (inputDate.getTime() === today.getTime()) {
                return 'Today';
            }
            
            // Check if date is tomorrow
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            if (inputDate.getTime() === tomorrow.getTime()) {
                return 'Tomorrow';
            }
            
            // Check if date is yesterday
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            
            if (inputDate.getTime() === yesterday.getTime()) {
                return 'Yesterday';
            }
            
            return date.toLocaleDateString('en-US', options);
        }
    </script>
</body>
</html>